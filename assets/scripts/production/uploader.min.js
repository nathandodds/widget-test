define(["jquery"],function($){function cancel(data){feedback.append("<p>"+data.name+" was cancelled.</p>")}function fallback(){feedback.html('Your browser does not support Flash. You can go <a href="#" target="_blank">here</a> to download the latest version of Flash.')}function fail(file){feedback.append("<p>"+file.name+" could not be uploaded.</p>")}function success(file,data){var data=$.parseJSON(data);"image"==data.type?(image_list.append('<p id="'+data.filename+'"><img src="'+site_path+"assets/uploads/images/"+data.filename+'" title="'+file.name+'" /><input type="hidden" name="multi-image['+data.filename+'][imgname]" value="'+data.filename+'" /><input type="button" class="btn del-image delete-image-js" data-imagename="'+data.filename+'" data-type="'+data.type+'" value="Delete" /></p>'),$("#imgname").val(data.filename)):"document"==data.type&&file_list.append('<p id="'+data.filename+'"><input type="text" name="downloads['+data.filename+'][title]" class="input" id="'+data.filename+'" value="'+data.name+'" /> <input type="hidden" name="downloads['+data.filename+'][name]" value="'+data.filename+'" /> <input type="button" class="btn del-image delete-image-js" data-imagename="'+data.filename+'" data-type="'+data.type+'" value="Delete" /><input type="hidden" name="document_name" value="'+data.filename+'" /></p>')}function select_error(file,errorCode,errorMsg){feedback.append("<p>"+file.name+" could not be uploaded. "+errorMsg+"</p>")}function jq(myid){return"#"+myid.replace(/(:|\.)/g,"\\$1")}require(["../utils/uploadify/uploadify.min"]);var feedback=$("#feedback-js");$("#upload-form-js");var file_list=$("#file-list-js");$("#file_upload");var image_list=$("#image-list-js");$("#image_upload"),$(".file-upload-js>div").each(function(){var settings={},id="",type=$(this).attr("data-type");"image"==type?(settings={height:23,width:75,buttonText:"Select Image",uploadLimit:number_of_images,formData:{type:"image"}},id="image_upload"):"document"==type&&(settings={height:23,width:100,buttonText:"Select Document",fileTypeExts:ext?ext:"*.pdf",formData:{type:"document"}},id="file_upload"),$(function(){$("#"+id).uploadify({wmode:"transparent",buttonClass:settings.buttonClass||"",buttonCursor:settings.buttonCursor||"hand",buttonText:"",buttonImage:settings.buttonImage||"",checkExists:settings.checkExists||"",debug:settings.debug||!1,fileObjName:settings.fileObjName||"Filedata",fileSizeLimit:settings.fileSizeLimit||"5mb",fileTypeDesc:settings.fileTypeDesc||"jpg, git or png",fileTypeExts:settings.fileTypeExts||"*.jpg; *.jpeg; *.gif; *.png",formData:settings.formData||{type:"image"},height:settings.height||50,itemTemplate:settings.itemTemplate||"",method:settings.method||"post",multi:settings.multi||!0,overrideEvents:settings.overrideEvents||["onSelectError","onDialogClose"],preventCaching:settings.preventCaching||!0,progressData:settings.progressData||"percentage",queueID:settings.queueID||!1,queueSizeLimit:settings.queueSizeLimit||100,removeCompleted:settings.removeCompleted||!0,removeTimeout:settings.removeTimeout||0,requeueErrors:settings.requeueErrors||!1,successTimeout:settings.successTimeout||30,swf:site_path+"assets/scripts/utils/uploadify/uploadify.swf",uploader:site_path+"admin/AJAX_uploadify",uploadLimit:settings.uploadLimit||999,width:settings.width||120,"z-index":"1",onCancel:function(data){cancel(data)},onFallback:function(){fallback()},onSelectError:function(file,errorCode,errorMsg){select_error(file,errorCode,errorMsg)},onUploadError:function(file,errorCode,errorMsg,errorString){fail(file,errorCode,errorMsg,errorString)},onUploadSuccess:function(file,data,response){success(file,data,response)}})})}),$(document).on("click",".delete-image-js",function(e){var target=e.target,imagename=$(target).attr("data-imagename"),type=$(target).attr("data-type"),id=$(target).attr("data-id"),gallery=$(target).attr("data-gallery");$.ajax({url:site_path+"AJAX_uploadify/delete",data:{imagename:imagename,type:type,id:id,gallery:gallery},type:"POST",dataType:"JSON",success:function(data){"deleted"==data[0]&&$(jq(imagename)).remove()}})})});